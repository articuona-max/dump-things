<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<title>Dump Things I Have Done</title>
<style>
    body {
        background: #020202;
        color: #00ff9c;
        font-family: monospace;
        margin: 0;
    }
    .wrap {
        max-width: 900px;
        margin: 60px auto;
        padding: 20px;
    }
    h1 {
        text-align: center;
        letter-spacing: 2px;
    }
    textarea {
        width: 100%;
        height: 180px;
        background: #000;
        color: #00ff9c;
        border: 1px solid #0f3;
        padding: 12px;
        resize: none;
    }
    button, input {
        width: 100%;
        background: #000;
        color: #00ff9c;
        border: 1px solid #0f3;
        padding: 10px;
        margin-top: 10px;
        cursor: pointer;
    }
    pre {
        background: #000;
        border: 1px solid #0f3;
        padding: 15px;
        margin-top: 20px;
        white-space: pre-wrap;
    }
    .hidden { display: none; }
</style>
</head>
<body>

<div class="wrap" id="login">
    <h1>üîê AUTH REQUIRED</h1>
    <input type="password" id="password" placeholder="Password">
    <button onclick="login()">Enter</button>
</div>

<div class="wrap hidden" id="app">
    <h1>üìù DUMP THINGS I HAVE DONE</h1>

    <textarea id="entry" placeholder="Dump anything. Anytime."></textarea>
    <button onclick="addEntry()">Append Entry</button>

    <button onclick="exportDump()">Export Encrypted Dump</button>
    <input type="file" onchange="importDump(event)">

    <pre id="log"></pre>
</div>

<script>
/* ===== CONFIG ===== */
const PASSWORD = "Gargoza@321";
const SALT = "dump-things-static-salt";
/* ================== */

let cryptoKey;
let dump = [];

/* ---------- CRYPTO ---------- */
async function deriveKey(password) {
    const enc = new TextEncoder();
    const baseKey = await crypto.subtle.importKey(
        "raw", enc.encode(password), "PBKDF2", false, ["deriveKey"]
    );
    return crypto.subtle.deriveKey(
        {
            name: "PBKDF2",
            salt: enc.encode(SALT),
            iterations: 150000,
            hash: "SHA-256"
        },
        baseKey,
        { name: "AES-GCM", length: 256 },
        false,
        ["encrypt", "decrypt"]
    );
}

async function encrypt(text) {
    const iv = crypto.getRandomValues(new Uint8Array(12));
    const data = new TextEncoder().encode(text);
    const encrypted = await crypto.subtle.encrypt(
        { name: "AES-GCM", iv },
        cryptoKey,
        data
    );
    return { iv: [...iv], data: [...new Uint8Array(encrypted)] };
}

async function decrypt(payload) {
    const iv = new Uint8Array(payload.iv);
    const data = new Uint8Array(payload.data);
    const decrypted = await crypto.subtle.decrypt(
        { name: "AES-GCM", iv },
        cryptoKey,
        data
    );
    return new TextDecoder().decode(decrypted);
}

/* ---------- APP ---------- */
async function login() {
    const pass = document.getElementById("password").value;
    if (pass !== PASSWORD) {
        alert("Access denied");
        return;
    }
    cryptoKey = await deriveKey(pass);
    document.getElementById("login").classList.add("hidden");
    document.getElementById("app").classList.remove("hidden");
}

function addEntry() {
    const text = document.getElementById("entry").value.trim();
    if (!text) return;

    dump.push({
        timestamp: new Date().toISOString(),
        text
    });

    document.getElementById("entry").value = "";
    render();
}

function render() {
    document.getElementById("log").textContent =
        dump.map(e =>
            `[${e.timestamp}]\n${e.text}\n`
        ).join("\n");
}

async function exportDump() {
    const encrypted = await encrypt(JSON.stringify(dump));
    const blob = new Blob(
        [JSON.stringify(encrypted)],
        { type: "application/octet-stream" }
    );
    const a = document.createElement("a");
    a.href = URL.createObjectURL(blob);
    a.download = "dump.enc";
    a.click();
}

async function importDump(e) {
    const file = e.target.files[0];
    const payload = JSON.parse(await file.text());
    const decrypted = await decrypt(payload);
    dump = JSON.parse(decrypted);
    render();
}
</script>

</body>
</html>
